<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendario Scout nel Bosco (2026‚Äì2029)</title>

<style>
  :root{
    --text:#eef7ef; --muted: rgba(238,247,239,.78);
    --overlayA: rgba(8,25,14,.55);
    --overlayB: rgba(8,25,14,.25);
    --panel: rgba(255,255,255,.10);
    --panel2: rgba(255,255,255,.14);
    --btn: rgba(0,0,0,.22);
    --btnBorder: rgba(255,255,255,.18);
    --shadow: 0 18px 50px rgba(0,0,0,.55);
    --radius: 18px;
    --bgUrl: url("bg_forest.jpg");
    --fliesOpacity: .75;
  }

  *{ box-sizing:border-box; }
  html, body { height:100%; }
  body{
    margin:0;
    color:var(--text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    overflow-x:hidden;
    background:#08190e;
  }

  /* SFONDO BOSCO */
  .bg{ position:fixed; inset:0; background-image:var(--bgUrl); background-size:cover; background-position:center; transform:scale(1.03); z-index:-3; }
  .bgOverlay{
    position:fixed; inset:0;
    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(124,255,138,.18), transparent 55%),
      radial-gradient(900px 600px at 90% 20%, rgba(255,210,77,.16), transparent 60%),
      linear-gradient(160deg, var(--overlayA), var(--overlayB));
    z-index:-2;
  }

  /* NEBBIA */
  .mist{
    position:fixed; inset:-60px;
    background:
      radial-gradient(520px 340px at 30% 30%, rgba(255,255,255,.10), transparent 70%),
      radial-gradient(700px 440px at 70% 45%, rgba(255,255,255,.08), transparent 72%),
      radial-gradient(520px 340px at 40% 80%, rgba(255,255,255,.07), transparent 70%);
    filter: blur(14px);
    opacity:.85;
    animation: drift 16s ease-in-out infinite alternate;
    pointer-events:none;
    z-index:-1;
  }
  @keyframes drift{ from{ transform: translate3d(-10px, 0, 0) scale(1.02);} to{ transform: translate3d(10px, -8px, 0) scale(1.03);} }

  /* FOGLIE */
  .leaves{ position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
  .leafFall{
    position:absolute; top:-80px;
    width: 28px; height: 28px;
    background: radial-gradient(circle at 30% 30%, rgba(255,210,77,.9), rgba(18,58,32,.25));
    border-radius: 6px 18px 6px 18px;
    opacity:0;
    box-shadow: 0 6px 20px rgba(0,0,0,.18);
    animation: leafDown var(--t) linear infinite, leafSpin calc(var(--t) * .75) ease-in-out infinite;
  }
  @keyframes leafDown{
    0%{ transform: translate3d(0,-60px,0); opacity:0; }
    8%{ opacity:.85; }
    50%{ opacity:.55; }
    100%{ transform: translate3d(var(--dx), 110vh, 0); opacity:0; }
  }
  @keyframes leafSpin{ 0%{ rotate:0deg; } 50%{ rotate:130deg; } 100%{ rotate:260deg; } }

  /* LUCCIOLE */
  .fireflies{ position:fixed; inset:0; pointer-events:none; z-index:0; opacity:var(--fliesOpacity); }
  .firefly{
    position:absolute;
    width:6px; height:6px;
    border-radius:50%;
    background: rgba(255,210,77,.95);
    box-shadow: 0 0 18px rgba(255,210,77,.85);
    opacity:0;
    animation: fly var(--t) linear infinite;
  }
  @keyframes fly{
    0%{ transform: translate(0,0) scale(.8); opacity:0; }
    12%{ opacity:.95; }
    50%{ opacity:.35; }
    100%{ transform: translate(var(--dx), var(--dy)) scale(1.25); opacity:0; }
  }

  .wrap{ position:relative; z-index:2; max-width:1080px; margin:22px auto 46px; padding:14px; }

  .topbar{
    display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    padding:14px; background:var(--panel); border:1px solid var(--panel2);
    border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter: blur(10px);
  }
  .title{ display:flex; gap:10px; align-items:center; font-weight:900; }
  .controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

  button, select{
    border:1px solid var(--btnBorder);
    background: var(--btn);
    color: var(--text);
    padding:10px 12px;
    border-radius:14px;
    cursor:pointer;
    outline:none;
    font-family:inherit;
  }
  button:hover, select:hover{ transform: translateY(-1px); }

  .monthTitle{ font-size:18px; font-weight:900; text-transform:capitalize; }
  .muted{ color: var(--muted); font-size:13px; }

  .stage{
    margin-top:14px;
    position:relative;
    border-radius:22px;
    overflow:hidden;
    box-shadow: var(--shadow);
    border:1px solid rgba(255,255,255,.14);
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    backdrop-filter: blur(10px);
  }
  .frame{ position:absolute; inset:0; background:url("frame.jpg") center/cover no-repeat; opacity:.96; pointer-events:none; z-index:1; }
  .content{ position:relative; z-index:2; padding:34px 26px 26px; }

  .grid{ display:grid; grid-template-columns:repeat(7, 1fr); gap:10px; }

  .dow{
    text-align:center;
    font-weight:900;
    font-size:13px;
    color: rgba(0,0,0,.80);
    background: rgba(255,255,255,.84);
    border-radius:12px;
    padding:10px 6px;
    border: 1px solid rgba(0,0,0,.08);
  }

  .day{
    border-radius:16px;
    padding:10px;
    background: rgba(255,255,255,.90);
    border:1px solid rgba(0,0,0,.08);
    color: rgba(0,0,0,.88);
    position:relative;
    overflow:hidden;
    display:flex;
    align-items:flex-start;
    justify-content:flex-start;
  }
  .day .n{ font-weight:900; font-size:16px; }

  /* Oggi */
  .today{
    outline: 3px solid rgba(124,255,138,.75);
    outline-offset:-3px;
  }

  /* TELEFONO: caselle pi√π quadrate */
  @media (max-width: 780px){
    .content{ padding: 18px 14px 14px; }
    .grid{ gap: 8px; }
    .day{
      aspect-ratio: 1 / 1;     /* QUADRATA */
      padding: 8px;
    }
    .day .n{ font-size:14px; }
    .monthTitle{ font-size:16px; }
  }

  /* SEZIONI SOTTO */
  .panel{
    margin-top:14px;
    background:var(--panel);
    border:1px solid var(--panel2);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    backdrop-filter: blur(10px);
    padding:14px;
  }
  .panel h3{ margin:0 0 10px; font-size:16px; }
  .cards{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:10px;
  }
  .card{
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12);
    border-radius: 16px;
    padding: 12px;
    overflow:hidden;
    position:relative;
  }
  .card::before{
    content:"";
    position:absolute; inset:-80px;
    background:
      radial-gradient(280px 200px at 20% 20%, rgba(124,255,138,.22), transparent 60%),
      radial-gradient(240px 180px at 80% 30%, rgba(255,210,77,.18), transparent 60%);
    filter: blur(12px);
    opacity:.9;
    pointer-events:none;
  }
  .card > *{ position:relative; z-index:1; }
  .kicker{ font-size:12px; color: var(--muted); margin-bottom:6px; }
  .big{ font-size:15px; font-weight:900; margin:0; }
  .small{ margin:6px 0 0; color: var(--muted); font-size:13px; }

  @media (max-width: 900px){
    .cards{ grid-template-columns: 1fr; }
  }

  /* MODAL LEGGI SCOUT */
  .modalBackdrop{
    position:fixed; inset:0;
    background: rgba(0,0,0,.60);
    display:none;
    align-items:center; justify-content:center;
    padding: 18px;
    z-index:99;
  }
  .modalBackdrop.show{ display:flex; }
  .modal{
    width:min(680px, 96vw);
    background: rgba(14,44,25,.92);
    border:1px solid rgba(255,255,255,.14);
    border-radius: 22px;
    box-shadow: var(--shadow);
    padding: 16px;
    transform: translateY(18px) scale(.95);
    opacity:0;
    animation: pop .32s ease forwards;
    overflow:hidden;
  }
  @keyframes pop{ to{ transform: translateY(0) scale(1); opacity:1; } }
  .modalHeader{ display:flex; justify-content:space-between; gap:12px; align-items:flex-start; padding:6px 6px 10px; }
  .modalTitle{ font-weight:900; font-size:18px; margin:0; }
  .modalBody{
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12);
    border-radius: 18px;
    padding: 12px;
    margin: 6px;
  }
  .line{
    display:flex; gap:10px; align-items:flex-start;
    padding:10px; border-radius:14px;
    background: rgba(0,0,0,.20);
    border:1px solid rgba(255,255,255,.10);
    margin-bottom: 10px;
    animation: slideIn .35s ease both;
  }
  @keyframes slideIn{ from{ transform: translateX(-12px); opacity:0; } to{ transform: translateX(0); opacity:1; } }
  .ico{ font-size: 22px; line-height:1; }
  .sub{ color: rgba(238,247,239,.85); font-size: 13px; margin:2px 0 0; }

  /* Footer Baden-Powell */
  .bp{
    margin-top:14px;
    background:var(--panel);
    border:1px solid var(--panel2);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    backdrop-filter: blur(10px);
    padding:14px;
    text-align:center;
  }
  .bp b{ font-weight:900; }
  .bp p{ margin:8px 0 0; color: var(--muted); }
</style>
</head>

<body>
  <div class="bg"></div>
  <div class="bgOverlay"></div>
  <div class="mist"></div>
  <div class="leaves" id="leaves"></div>
  <div class="fireflies" id="fireflies"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="title">
        <div style="font-size:22px;">üå≤</div>
        <div>
          <div style="font-size:16px;font-weight:900;">Calendario Scout nel Bosco</div>
          <div class="muted">2026 ‚Üí 2029 ‚Ä¢ solo calendario + giornate a tema + countdown</div>
        </div>
      </div>

      <div class="controls">
        <button id="prev">‚¨ÖÔ∏è</button>
        <div class="monthTitle" id="monthTitle">‚Äî</div>
        <button id="next">‚û°Ô∏è</button>

        <select id="yearSel">
          <option>2026</option>
          <option>2027</option>
          <option>2028</option>
          <option>2029</option>
        </select>

        <button id="todayBtn">Oggi</button>
      </div>
    </div>

    <div class="stage" id="stage">
      <div class="frame"></div>
      <div class="content">
        <div class="grid" id="dow"></div>
        <div style="height:10px"></div>
        <div class="grid" id="cal"></div>
      </div>
    </div>

    <!-- LEGGE SCOUT SOTTO AL CALENDARIO -->
    <div class="panel">
      <h3>üìú Legge Scout</h3>
      <p class="muted" style="margin:0 0 10px;">
        Tocca il pulsante per leggere le leggi scout.
      </p>
      <button id="lawsBtn">Leggi Scout</button>
    </div>

    <!-- GIORNATE A TEMA -->
    <div class="panel">
      <h3>üåç Giornate a tema</h3>
      <p class="muted" style="margin:0 0 10px;">
        Qui vedi le prossime giornate speciali (con simboli). Quando una data arriva, diventa ‚ÄúOggi‚Äù.
      </p>
      <div class="cards" id="themeCards"></div>
    </div>

    <!-- COUNTDOWN -->
    <div class="panel">
      <h3>üß≠ Countdown agli eventi importanti</h3>
      <p class="muted" style="margin:0 0 10px;">
        Conto alla rovescia automatico dagli eventi che decidi tu.
      </p>
      <div class="cards" id="countCards"></div>
    </div>

    <div class="bp">
      <div>‚öúÔ∏è <b>Robert Baden-Powell</b> (fondatore degli scout)</div>
      <p>‚ÄúLascia il posto migliore di come lo hai trovato.‚Äù</p>
    </div>
  </div>

  <!-- MODAL LEGGI SCOUT -->
  <div class="modalBackdrop" id="lawsBackdrop">
    <div class="modal">
      <div class="modalHeader">
        <h3 class="modalTitle">üìú Legge Scout</h3>
        <button id="lawsClose">Chiudi ‚úñ</button>
      </div>
      <div class="modalBody">
        <div class="line"><div class="ico">1Ô∏è‚É£</div><div><b>Lo scout √® leale.</b><div class="sub">Dice la verit√† e mantiene la parola data.</div></div></div>
        <div class="line"><div class="ico">2Ô∏è‚É£</div><div><b>Lo scout √® amico di tutti e fratello di ogni altro scout.</b><div class="sub">Aiuta senza guardare chi sei.</div></div></div>
        <div class="line"><div class="ico">3Ô∏è‚É£</div><div><b>Lo scout √® cortese.</b><div class="sub">Rispetta gli altri e si comporta bene.</div></div></div>
        <div class="line"><div class="ico">4Ô∏è‚É£</div><div><b>Lo scout ama e rispetta la natura.</b><div class="sub">Protegge il bosco, gli animali e l‚Äôambiente.</div></div></div>
        <div class="line"><div class="ico">5Ô∏è‚É£</div><div><b>Lo scout sorride e canta anche nelle difficolt√†.</b><div class="sub">Non si arrende e porta buon umore.</div></div></div>
        <div class="line"><div class="ico">6Ô∏è‚É£</div><div><b>Lo scout √® laborioso ed economo.</b><div class="sub">Usa bene le cose e non spreca.</div></div></div>
        <div class="line"><div class="ico">7Ô∏è‚É£</div><div><b>Lo scout √® puro nei pensieri, parole e azioni.</b><div class="sub">Fa scelte giuste e rispettose.</div></div></div>
      </div>
    </div>
  </div>

<script>
  // =========================
  // UTIL
  // =========================
  const pad = n => String(n).padStart(2,"0");
  const ymd = (y,m,d) => `${y}-${pad(m)}-${pad(d)}`;
  const itMonth = (y,m) => new Date(y, m-1, 1).toLocaleString("it-IT",{month:"long", year:"numeric"});
  const DOW = ["Lun","Mar","Mer","Gio","Ven","Sab","Dom"];
  const inRange = y => (y>=2026 && y<=2029);

  // =========================
  // DOM
  // =========================
  const dowEl = document.getElementById("dow");
  const calEl = document.getElementById("cal");
  const monthTitleEl = document.getElementById("monthTitle");
  const yearSel = document.getElementById("yearSel");

  const lawsBtn = document.getElementById("lawsBtn");
  const lawsBackdrop = document.getElementById("lawsBackdrop");
  const lawsClose = document.getElementById("lawsClose");

  const themeCards = document.getElementById("themeCards");
  const countCards = document.getElementById("countCards");

  // =========================
  // STATO
  // =========================
  let stateYear = 2026;
  let stateMonth = 1;

  // =========================
  // NIENTE EVENTI SUL CALENDARIO ‚úÖ
  // (qui non mettiamo nulla nei giorni)
  // =========================

  // =========================
  // GIORNATE A TEMA (vere) ‚úÖ
  // Puoi aggiungere quante vuoi.
  // Formato: { date:"MM-DD", name:"...", icon:"..." }
  // =========================
  const THEME_DAYS = [
    { date:"01-21", icon:"ü§ó", name:"Giornata Mondiale degli Abbracci" },
    { date:"03-21", icon:"üå≥", name:"Giornata Internazionale delle Foreste" },
    { date:"03-22", icon:"üíß", name:"Giornata Mondiale dell‚ÄôAcqua" },
    { date:"04-22", icon:"üåç", name:"Giornata della Terra" },
    { date:"05-20", icon:"üêù", name:"Giornata Mondiale delle Api" },
    { date:"06-05", icon:"üå±", name:"Giornata Mondiale dell‚ÄôAmbiente" },
    { date:"09-21", icon:"üïäÔ∏è", name:"Giornata Internazionale della Pace" },
    { date:"10-04", icon:"üêæ", name:"Giornata Mondiale degli Animali" }
  ];

  // Giornate scout ‚Äúa tema‚Äù (non mondiali, ma per il calendario scout)
  const SCOUT_THEME = [
    { date:"02-22", icon:"‚öúÔ∏è", name:"Giornata del Pensiero (Scout)" },
    { date:"04-23", icon:"üõ°Ô∏è", name:"San Giorgio (tradizione scout)" }
  ];

  // =========================
  // COUNTDOWN EVENTI IMPORTANTI ‚úÖ
  // (qui metti le date reali dei tuoi eventi)
  // =========================
  const COUNTDOWN_EVENTS = [
    { date:"2026-07-15", icon:"üî•", name:"Campo estivo" },
    { date:"2026-08-24", icon:"üß≠", name:"Route" }
  ];

  // =========================
  // CALENDARIO - CALCOLI
  // =========================
  function firstDayOffset(y,m){
    const js = new Date(y, m-1, 1).getDay();
    return (js + 6) % 7; // lun=0..dom=6
  }
  function daysInMonth(y,m){ return new Date(y, m, 0).getDate(); }

  // =========================
  // TEMA: giorno/notte + stagione (solo overlay e lucciole)
  // =========================
  function setTheme(){
    const m = stateMonth;
    const hour = new Date().getHours();
    const night = (hour >= 20 || hour < 7);

    let overlayA = "rgba(8,25,14,.55)", overlayB = "rgba(8,25,14,.25)";
    if([12,1,2].includes(m)) { overlayA="rgba(8,16,32,.62)"; overlayB="rgba(8,16,32,.28)"; }    // inverno
    if([6,7,8].includes(m)) { overlayA="rgba(40,22,6,.55)"; overlayB="rgba(15,35,18,.20)"; }     // estate
    if([9,10,11].includes(m)) { overlayA="rgba(22,12,6,.60)"; overlayB="rgba(15,30,16,.22)"; }   // autunno

    document.documentElement.style.setProperty("--overlayA", night ? "rgba(0,0,0,.72)" : overlayA);
    document.documentElement.style.setProperty("--overlayB", night ? "rgba(0,0,0,.32)" : overlayB);
    document.documentElement.style.setProperty("--fliesOpacity", night ? ".95" : ".55");
  }

  // =========================
  // RENDER DOW
  // =========================
  function renderDOW(){
    dowEl.innerHTML = "";
    DOW.forEach(d=>{
      const div = document.createElement("div");
      div.className="dow";
      div.textContent = d;
      dowEl.appendChild(div);
    });
  }

  // =========================
  // RENDER CALENDARIO (senza eventi)
  // =========================
  function renderCalendar(){
    if(!inRange(stateYear)){ stateYear=2026; stateMonth=1; }
    setTheme();
    monthTitleEl.textContent = itMonth(stateYear, stateMonth);
    yearSel.value = String(stateYear);

    calEl.innerHTML = "";

    const today = new Date();
    const todayKey = ymd(today.getFullYear(), today.getMonth()+1, today.getDate());

    const offset = firstDayOffset(stateYear, stateMonth);
    const dim = daysInMonth(stateYear, stateMonth);

    const prevMonth = stateMonth === 1 ? 12 : stateMonth - 1;
    const prevYear  = stateMonth === 1 ? stateYear - 1 : stateYear;
    const nextMonth = stateMonth === 12 ? 1 : stateMonth + 1;
    const nextYear  = stateMonth === 12 ? stateYear + 1 : stateYear;

    const dimPrev = daysInMonth(prevYear, prevMonth);

    let cells = 0;

    for(let i=0;i<offset;i++){
      const dayNum = dimPrev - offset + 1 + i;
      const key = ymd(prevYear, prevMonth, dayNum);
      calEl.appendChild(makeDayCell(prevYear, prevMonth, dayNum, key, true, todayKey));
      cells++;
    }

    for(let d=1; d<=dim; d++){
      const key = ymd(stateYear, stateMonth, d);
      calEl.appendChild(makeDayCell(stateYear, stateMonth, d, key, false, todayKey));
      cells++;
    }

    let nextDay = 1;
    while(cells < 42){
      const key = ymd(nextYear, nextMonth, nextDay);
      calEl.appendChild(makeDayCell(nextYear, nextMonth, nextDay, key, true, todayKey));
      cells++;
      nextDay++;
    }
  }

  function makeDayCell(y,m,d,key,isOff,todayKey){
    const div = document.createElement("div");
    div.className = "day" + (isOff ? " off" : "") + (key===todayKey ? " today" : "");
    div.innerHTML = `<div class="n">${d}</div>`;
    return div;
  }

  // =========================
  // LEGGE SCOUT (modal)
  // =========================
  lawsBtn.addEventListener("click", ()=> lawsBackdrop.classList.add("show"));
  lawsClose.addEventListener("click", ()=> lawsBackdrop.classList.remove("show"));
  lawsBackdrop.addEventListener("click", (e)=>{ if(e.target===lawsBackdrop) lawsBackdrop.classList.remove("show"); });

  // =========================
  // GIORNATE A TEMA: mostra prossime 6
  // =========================
  function nextThemeDays(){
    const now = new Date();
    const year = now.getFullYear();
    const list = [...THEME_DAYS, ...SCOUT_THEME].map(x=>{
      const [mm,dd] = x.date.split("-").map(n=>parseInt(n,10));
      let d = new Date(year, mm-1, dd);
      if(d < new Date(year, now.getMonth(), now.getDate())) d = new Date(year+1, mm-1, dd);
      return { ...x, nextDate: d };
    }).sort((a,b)=> a.nextDate - b.nextDate);

    return list.slice(0,6);
  }

  function renderThemeDays(){
    const now = new Date();
    const todayYMD = ymd(now.getFullYear(), now.getMonth()+1, now.getDate());

    themeCards.innerHTML = "";
    nextThemeDays().forEach(x=>{
      const d = x.nextDate;
      const key = ymd(d.getFullYear(), d.getMonth()+1, d.getDate());
      const isToday = (key === todayYMD);

      const label = d.toLocaleDateString("it-IT", {weekday:"long", day:"2-digit", month:"long", year:"numeric"});
      const card = document.createElement("div");
      card.className="card";
      card.innerHTML = `
        <div class="kicker">${isToday ? "‚úÖ Oggi" : "üìÖ Prossima data"}</div>
        <p class="big">${x.icon} ${x.name}</p>
        <p class="small">${label}</p>
      `;
      themeCards.appendChild(card);
    });
  }

  // =========================
  // COUNTDOWN
  // =========================
  function daysBetween(a,b){
    const A = new Date(a.getFullYear(), a.getMonth(), a.getDate());
    const B = new Date(b.getFullYear(), b.getMonth(), b.getDate());
    const ms = B - A;
    return Math.round(ms / (1000*60*60*24));
  }

  function renderCountdown(){
    const now = new Date();
    countCards.innerHTML = "";

    // ordina per prossimit√† e mostra 3
    const list = COUNTDOWN_EVENTS
      .map(e=>{
        const [y,m,d] = e.date.split("-").map(n=>parseInt(n,10));
        const dateObj = new Date(y, m-1, d);
        return { ...e, dateObj, diff: daysBetween(now, dateObj) };
      })
      .filter(e=> e.diff >= 0)
      .sort((a,b)=> a.diff - b.diff)
      .slice(0,3);

    if(list.length === 0){
      const card = document.createElement("div");
      card.className="card";
      card.innerHTML = `<div class="kicker">üß≠ Countdown</div><p class="big">Nessun evento impostato</p>
        <p class="small">Aggiungi date nel codice (COUNTDOWN_EVENTS).</p>`;
      countCards.appendChild(card);
      return;
    }

    list.forEach(e=>{
      const when = e.dateObj.toLocaleDateString("it-IT", {day:"2-digit", month:"long", year:"numeric"});
      let msg = `Mancano ${e.diff} giorni a ${e.name}`;
      if(e.diff === 0) msg = `√à oggi: ${e.name}!`;
      if(e.diff <= 7 && e.diff > 0) msg = `Ultima settimana prima di ${e.name} ‚ú® (mancano ${e.diff} giorni)`;

      const card = document.createElement("div");
      card.className="card";
      card.innerHTML = `
        <div class="kicker">${e.icon} Countdown</div>
        <p class="big">${msg}</p>
        <p class="small">üìÖ ${when}</p>
      `;
      countCards.appendChild(card);
    });
  }

  // =========================
  // NAV
  // =========================
  document.getElementById("prev").addEventListener("click", ()=>{
    stateMonth--;
    if(stateMonth<1){ stateMonth=12; stateYear--; }
    if(!inRange(stateYear)){ stateYear=2026; stateMonth=1; }
    renderCalendar();
  });
  document.getElementById("next").addEventListener("click", ()=>{
    stateMonth++;
    if(stateMonth>12){ stateMonth=1; stateYear++; }
    if(!inRange(stateYear)){ stateYear=2029; stateMonth=12; }
    renderCalendar();
  });
  yearSel.addEventListener("change", ()=>{
    stateYear = parseInt(yearSel.value,10);
    renderCalendar();
  });
  document.getElementById("todayBtn").addEventListener("click", ()=>{
    const t = new Date();
    if(t.getFullYear()<2026 || t.getFullYear()>2029){ stateYear=2026; stateMonth=1; }
    else { stateYear=t.getFullYear(); stateMonth=t.getMonth()+1; }
    renderCalendar();
  });

  // Swipe mese su mobile (sul calendario)
  const stage = document.getElementById("stage");
  let touchStartX = null;
  stage.addEventListener("touchstart",(e)=>{ touchStartX = e.touches[0].clientX; }, {passive:true});
  stage.addEventListener("touchend",(e)=>{
    if(touchStartX===null) return;
    const endX = e.changedTouches[0].clientX;
    const dx = endX - touchStartX;
    touchStartX = null;
    if(Math.abs(dx) < 40) return;
    if(dx < 0) document.getElementById("next").click();
    else document.getElementById("prev").click();
  }, {passive:true});

  // =========================
  // Spawn foglie + lucciole
  // =========================
  function spawnLeaves(){
    const box = document.getElementById("leaves");
    box.innerHTML = "";
    const n = 28;
    for(let i=0;i<n;i++){
      const l = document.createElement("div");
      l.className = "leafFall";
      l.style.left = (Math.random()*100) + "%";
      l.style.setProperty("--t", (8 + Math.random()*10) + "s");
      l.style.setProperty("--dx", ((Math.random()*220)-110) + "px");
      l.style.animationDelay = (Math.random()*6) + "s";
      const s = 0.75 + Math.random()*1.0;
      l.style.width = (28*s) + "px";
      l.style.height = (28*s) + "px";
      box.appendChild(l);
    }
  }

  function spawnFireflies(){
    const box = document.getElementById("fireflies");
    box.innerHTML = "";
    const n = 16;
    for(let i=0;i<n;i++){
      const f = document.createElement("div");
      f.className = "firefly";
      f.style.left = (Math.random()*100) + "%";
      f.style.top  = (Math.random()*100) + "%";
      f.style.setProperty("--t", (6 + Math.random()*8) + "s");
      f.style.setProperty("--dx", ((Math.random()*240)-120) + "px");
      f.style.setProperty("--dy", ((Math.random()*220)-160) + "px");
      f.style.animationDelay = (Math.random()*3) + "s";
      box.appendChild(f);
    }
  }

  window.addEventListener("resize", ()=>{ spawnLeaves(); spawnFireflies(); });

  // =========================
  // AVVIO
  // =========================
  renderDOW();
  spawnLeaves();
  spawnFireflies();
  renderCalendar();
  renderThemeDays();
  renderCountdown();
  setInterval(()=>{ setTheme(); renderThemeDays(); renderCountdown(); }, 60000);
</script>
</body>
</html>
